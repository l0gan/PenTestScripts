#! /bin/bash
# Use:  ./engagementStarter.sh <target ip/subnet> <customerName>
# e.g.:  ./engagementStarter.sh 192.168.108.1/24 homeNetwork1
# you must have the following tools installed:
#   - nmap
#   - metasploit pro (if just metasploit, modify the msfpro to msfconsole and remove the --
#   - EyeWitness (obtain from https://github.com/ChrisTruncer/EyeWitness) located at /opt/EyeWitness
#   - sslscan
#   - snmpcheck
#  Most of these tools come pre-installed in Kali


# create working folder
mkdir $2
cd $2

# Start nmap for network
nmap -sn $1 -oG discoveryScan.gnmap && cat discoveryScan.gnmap | awk '{print $2}' | grep -v Nmap > ActiveIPs.txt
nmap -p- -A -iL ActiveIPs.txt -oA FullscanTCP
nmap -sU --top-ports 20 -iL ActiveIPs.txt -oA FullscanUDP

# import results into metasploit pro
msfpro -- -x "db_status;workspace;workspace -a $2;workspace $2;db_import FullscanTCP.xml;db_import FullscanUDP.xml;exit -y"

#create https list
python /opt/EyeWitness/EyeWitness.py -f FullscanTCP.xml --createtargets HTTP-s_targets.txt
cat HTTP-s_targets.txt | grep https |sed 's/^........//' > httpsTargets.txt

# run sslscan on ssl hosts
sslscan --targets=httpsTargets.txt

# run snmpcheck on snmp hosts
cat FullscanUDP.gnmap | grep 161/open/ | awk '{print $2}' > snmpHosts.txt
while read h; do snmpcheck -t $h ;done <snmpHosts.txt

# run eyewitness to scrape http/s pages
python /opt/EyeWitness/EyeWitness.py -d $2 -f FullscanTCP.xml
iceweasel /opt/EyeWitness/$2/report.html &

# Start responder for network
#gnome-terminal -e "responder -i $2 -I eth0 -wrf" &


